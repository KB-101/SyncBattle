<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PlaySync Arena - Real-Time Mobile Gaming with Friends</title>
    <meta name="description" content="Play Android games together in real-time with friends">
    
    <!-- Cache Control -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    
    <!-- PWA Meta Tags -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    
    <!-- Firebase v8 (Optimized Imports) -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-messaging.js"></script>
    <!-- Push Notifications -->
<script src="push-notifications.js?v=2.0.1"></script>
    
    <!-- Styles -->
    <link rel="stylesheet" href="style.css?v=2.0.1">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="icons/icon-96.png">
</head>
<body>
    <!-- Loading Screen -->
    <div id="loadingScreen">
        <div class="spinner"></div>
        <div class="loading-text">Loading PlaySync Arena v2.0.1...</div>
    </div>

    <!-- Main App Content -->
    <div id="appContent" style="display: none;">
        <div class="container">
            <!-- Header -->
            <header>
                <h1><i class="fas fa-gamepad"></i> PlaySync Arena</h1>
                <p class="tagline">Real-time gaming with friends</p>
                <div class="header-actions">
                    <button id="notificationToggle" class="icon-btn notification-bell">
                        <i class="fas fa-bell"></i>
                        <span id="notificationCount" class="notification-badge hidden">0</span>
                    </button>
                </div>
            </header>

            <main>
                <div class="app-layout">
                    <!-- Left Panel -->
                    <div class="left-panel">
                        <!-- User Profile Card -->
                        <div class="card user-profile">
                            <h2><i class="fas fa-user"></i> Your Profile</h2>
                            <div class="user-info">
                                <div class="avatar">
                                    <i class="fas fa-user-circle"></i>
                                </div>
                                <div class="user-details">
                                    <input type="text" id="userName" placeholder="Your name" maxlength="20">
                                    <div class="id-display">
                                        <span id="userIdDisplay">Loading...</span>
                                        <button id="copyIdBtn" class="icon-btn" title="Copy ID">
                                            <i class="fas fa-copy"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div class="user-status">
                                <span class="status-dot" id="statusDot"></span>
                                <span id="statusText">Connecting...</span>
                            </div>
                        </div>

                        <!-- Friend Connection Card -->
                        <div class="card friend-connect">
                            <h2><i class="fas fa-user-friends"></i> Friends</h2>
                            <div class="friend-search">
                                <input type="text" id="friendId" placeholder="Enter friend ID or username">
                                <button id="connectBtn" class="btn primary">
                                    <i class="fas fa-plus"></i> Add
                                </button>
                            </div>
                            
                            <div id="friendsList" class="friends-list">
                                <!-- Friends will be loaded here -->
                                <div class="empty-friends">
                                    <i class="fas fa-user-friends"></i>
                                    <p>No friends yet. Add someone to play with!</p>
                                </div>
                            </div>
                        </div>

                        <!-- Quick Messages Card -->
                        <div class="card quick-messages">
                            <h2><i class="fas fa-comment-alt"></i> Quick Chat</h2>
                            <div id="chatMessages" class="chat-messages">
                                <!-- Messages will appear here -->
                            </div>
                            <div class="message-input">
                                <input type="text" id="messageInput" placeholder="Type a message..." onkeypress="if(event.key==='Enter') sendMessage();">
                                <button id="sendMessageBtn" class="btn primary">
                                    <i class="fas fa-paper-plane"></i>
                                </button>
                            </div>
                            <div class="quick-actions">
                                <button class="quick-msg" data-msg="Ready to play?">üéÆ Ready?</button>
                                <button class="quick-msg" data-msg="Your turn!">üëÜ Your turn!</button>
                                <button class="quick-msg" data-msg="Good game!">üëç GG!</button>
                                <button class="quick-msg" data-msg="Let's play again">üîÑ Again?</button>
                            </div>
                        </div>
                    </div>

                    <!-- Right Panel -->
                    <div class="right-panel">
                        <!-- Active Game Session -->
                        <div id="activeSessionCard" class="card active-session hidden">
                            <h2><i class="fas fa-play-circle"></i> Active Session</h2>
                            <div id="sessionInfo" class="session-info">
                                <!-- Game session info will appear here -->
                            </div>
                            <div class="session-actions">
                                <button id="syncGameBtn" class="btn success">
                                    <i class="fas fa-sync-alt"></i> Sync Now
                                </button>
                                <button id="endSessionBtn" class="btn danger">
                                    <i class="fas fa-stop"></i> End Session
                                </button>
                            </div>
                        </div>

                        <!-- Games Grid -->
                        <div class="card games-grid">
                            <h2><i class="fas fa-gamepad"></i> Popular Games</h2>
                            <p class="subtitle">Play these games with friends in real-time</p>
                            
                            <div class="games-container">
                                <!-- Game Cards -->
                                <div class="game-card" data-game="pool">
                                    <div class="game-icon">
                                        <i class="fas fa-basketball-ball"></i>
                                    </div>
                                    <div class="game-info">
                                        <h3>8 Ball Pool</h3>
                                        <p>Real-time billiards</p>
                                        <div class="game-stats">
                                            <span><i class="fas fa-users"></i> Multiplayer</span>
                                        </div>
                                    </div>
                                    <button class="game-action-btn challenge-btn" data-game="pool">
                                        <i class="fas fa-bolt"></i>
                                    </button>
                                </div>

                                <div class="game-card" data-game="chess">
                                    <div class="game-icon">
                                        <i class="fas fa-chess"></i>
                                    </div>
                                    <div class="game-info">
                                        <h3>Chess</h3>
                                        <p>Strategy game</p>
                                        <div class="game-stats">
                                            <span><i class="fas fa-clock"></i> Turn-based</span>
                                        </div>
                                    </div>
                                    <button class="game-action-btn challenge-btn" data-game="chess">
                                        <i class="fas fa-bolt"></i>
                                    </button>
                                </div>

                                <div class="game-card" data-game="ludo">
                                    <div class="game-icon">
                                        <i class="fas fa-dice"></i>
                                    </div>
                                    <div class="game-info">
                                        <h3>Ludo King</h3>
                                        <p>Classic board game</p>
                                        <div class="game-stats">
                                            <span><i class="fas fa-users"></i> 2-4 Players</span>
                                        </div>
                                    </div>
                                    <button class="game-action-btn challenge-btn" data-game="ludo">
                                        <i class="fas fa-bolt"></i>
                                    </button>
                                </div>

                                <div class="game-card" data-game="custom">
                                    <div class="game-icon">
                                        <i class="fas fa-plus"></i>
                                    </div>
                                    <div class="game-info">
                                        <h3>Custom Game</h3>
                                        <p>Any Android game</p>
                                        <input type="text" id="customGameId" class="custom-game-input" placeholder="Package ID (e.g., com.game.example)">
                                    </div>
                                    <button id="customChallengeBtn" class="btn primary" style="margin-top: 10px;">
                                        <i class="fas fa-bolt"></i> Challenge
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Online Friends -->
                        <div class="card online-friends">
                            <h2><i class="fas fa-wifi"></i> Online Now</h2>
                            <div id="onlineFriendsList" class="online-list">
                                <div class="empty-online">
                                    <i class="fas fa-user-slash"></i>
                                    <p>No friends online</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </main>

            <!-- Footer -->
            <footer>
                <div class="footer-content">
                    <div class="footer-section">
                        <span id="connectionStatus" class="connection-status">
                            <i class="fas fa-circle offline"></i> <span id="connectionText">Connecting...</span>
                        </span>
                        <span class="player-count">
                            <i class="fas fa-users"></i> <span id="onlineCount">0</span> online
                        </span>
                    </div>
                    <div class="footer-section">
                        <button id="settingsBtn" class="icon-btn">
                            <i class="fas fa-cog"></i>
                        </button>
                        <button id="clearCacheBtn" class="icon-btn">
                            <i class="fas fa-trash"></i>
                        </button>
                        <button id="installBtn" class="btn secondary small hidden">
                            <i class="fas fa-download"></i> Install
                        </button>
                    </div>
                </div>
            </footer>
        </div>
    </div>

    <!-- Modals -->
    <div id="friendModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-user-friends"></i> Friend Options</h3>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div id="selectedFriendInfo"></div>
                <div class="friend-actions">
                    <button id="inviteToGameBtn" class="btn primary">
                        <i class="fas fa-gamepad"></i> Invite to Game
                    </button>
                    <button id="messageFriendBtn" class="btn secondary">
                        <i class="fas fa-comment"></i> Send Message
                    </button>
                    <button id="removeFriendBtn" class="btn danger">
                        <i class="fas fa-user-times"></i> Remove Friend
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div id="gameInviteModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-bolt"></i> Game Invite</h3>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div id="inviteInfo"></div>
                <div class="invite-actions">
                    <button id="acceptInviteBtn" class="btn success">
                        <i class="fas fa-check"></i> Accept & Play
                    </button>
                    <button id="declineInviteBtn" class="btn danger">
                        <i class="fas fa-times"></i> Decline
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div id="gameSelectorModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-gamepad"></i> Select Game</h3>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <p>Select a game to challenge <span id="selectedFriendName">Friend</span>:</p>
                <div class="modal-games-list">
                    <!-- Games will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <div id="notificationsPanel" class="notifications-panel hidden">
        <div class="panel-header">
            <h3><i class="fas fa-bell"></i> Notifications</h3>
            <button id="clearNotificationsBtn" class="btn small">Clear All</button>
        </div>
        <div id="notificationsList" class="notifications-list">
            <!-- Notifications will appear here -->
        </div>
    </div>

    <!-- Toast Container -->
    <div id="toastContainer" class="toast-container"></div>

    <!-- Main Script -->
    <script src="script.js?v=2.0.1"></script>
    
    <!-- Service Worker Registration -->
    <script>
       <script>
    // Register service workers
    if ('serviceWorker' in navigator) {
        // Wait for page to load
        window.addEventListener('load', async function() {
            try {
                // Register main service worker
                const mainRegistration = await navigator.serviceWorker.register('service-worker.js');
                console.log('Main Service Worker registered:', mainRegistration.scope);
                
                // Register Firebase messaging service worker
                const messagingRegistration = await navigator.serviceWorker.register('firebase-messaging-sw.js');
                console.log('Messaging Service Worker registered:', messagingRegistration.scope);
                
                // Wait for service workers to be ready
                await navigator.serviceWorker.ready;
                console.log('Service Workers ready');
                
                // Test communication with service workers
                if (mainRegistration.active) {
                    mainRegistration.active.postMessage({
                        type: 'TEST_SERVICE_WORKER'
                    });
                }
                
                // Listen for messages from service workers
                navigator.serviceWorker.addEventListener('message', event => {
                    console.log('Message from Service Worker:', event.data);
                    
                    if (event.data.type === 'notification_opened') {
                        // Handle notification data from service worker
                        console.log('Notification opened with data:', event.data.data);
                    }
                });
                
            } catch (error) {
                console.error('Service Worker registration failed:', error);
            }
        });
        
        // Handle service worker updates
        let refreshing = false;
        navigator.serviceWorker.addEventListener('controllerchange', () => {
            if (!refreshing) {
                refreshing = true;
                window.location.reload();
            }
        });
    }
    
    // Initialize push notifications after page loads
    window.addEventListener('load', function() {
        setTimeout(() => {
            if ('Notification' in window && Notification.permission === 'default') {
                // You can prompt for permission here if needed
                console.log('Notification permission available');
            }
        }, 3000);
    });
</script>
    </script>
</body>
</html>
